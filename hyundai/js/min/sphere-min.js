!function(){function n(n,t,e){var r,o={},i=e;if("<"===n.charAt(0))r=document.createElement("div"),r.innerHTML=n,r=r.firstElementChild;else{var u=/([.#][^.#]*)/g,a;for(r=document.createElement(n.split(/[#.]/)[0]);a=u.exec(n);)a=a[0],"#"===a.charAt(0)?r.id=a.substring(1):r.classList.add(a.substring(1))}return k.String(t)?r.innerHTML=t:k.Object(t)?o=t:k.Array(t)?o.children=t:i=t,o&&Z.loopObj(o,function(n,t){if(void 0!==t)switch(n){case"classList":k.String(t)?r.classList.add(t):k.Array(t)&&X(t,function(n){r.classList.add(n)});break;case"css":C(r,t);break;case"children":k.Array(t)?X(t,function(n){r.appendChild(n)}):r.appendChild(t);break;default:"data-"===n.substring(0,5)?r.setAttribute(n,t):r[n]=t}}),i&&i.appendChild(r),r}function t(){var n=null,t=null;return{head:function(){return n},tail:function(){return t},node:function(n){return{previous:null,next:null,value:n}},remove:function(e){e.previous?e.previous.next=e.next:n=e.next,e.next?e.next.previous=e.previous:t=e.previous},insert:function(e,r){var o=r?r.previous:t;return e.next=r,e.previous=o,o?o.next=e:n=e,r?r.previous=e:t=e,e}}}function e(){var n=t();return{trig:function(){var e=arguments;t.loop(n,function(n){n.apply(null,e)})},regist:function(t){var e=n.insert(n.node(t),null);return{remove:function(){n.remove(e)}}}}}function r(n,t,e,r){var o;return n.addEventListener?(n.addEventListener(t,e,r||!1),o=function(){n.removeEventListener(t,e,r||!1)}):(n.attachEvent("on"+t,e),o=function(){n.detachEvent("on"+t,e)}),{remove:o}}function o(n,t,e){return r(n,"touchend",t,e)}function i(n,t){function o(o,i,u){return r(n,o,function(n){var o=n.zPageX,a=n.zPageY,c=e(),s=e(),f=r(document,i,function(n){o=n.zPageX,a=n.zPageY,n.onMove=c.regist,n.onUp=s.regist,c.trig(n,o,a)}),l=r(document,u,function(n){s.trig(n,o,a),f.remove(),l.remove()});n.onMove=c.regist,n.onUp=s.regist,t(n,o,a)})}return n.onTouchStart||n.onCursorDown?n.onTouchDown(t):o("touchstart","touchmove","touchend")}function u(n,t){return n+"("+t.join(",")+")"}function a(n){return Math.abs(n)<.01?0:n}function c(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function s(n){var t=Math.sin(n),e=Math.cos(n);return[1,0,0,0,0,e,-t,0,0,t,e,0,0,0,0,1]}function f(n){var t=Math.sin(n),e=Math.cos(n);return[e,0,t,0,0,1,0,0,-t,0,e,0,0,0,0,1]}function l(n,t){var e=new Array(4),r=4*t;return j(4,function(t){e[t]=n[r+t]}),e}function v(n,t){var e=new Array(4);return j(4,function(r){e[r]=n[4*r+t]}),e}function d(n,t){var e=0;return j(4,function(r){e+=n[r]*t[r]}),e}function p(n){var t=new Array(16);return j(4,function(e){var r=4*e;j(4,function(o){t[r+o]=n[o][e]})}),t}function m(n,t){var e=new Array(4);return j(4,function(r){e[r]=d(l(n,r),t)}),e}function h(n,t){var e=new Array(4);return j(4,function(r){e[r]=m(n,v(t,r))}),p(e)}function g(n,t,e){return h(h(n,s(e)),f(-t))}function w(n){var t=new Array(4);return j(4,function(e){t[e]=l(n,e)}),p(t)}function A(n,t){return m(w(n),t)}function y(n,t,e){var r=[.7623577990635768,.3083251657260024,-.568986975586412,.8775183418402467,-.2953121248763029,-.37782576491682895,.14220400694862798,.36554229950395606,-.9198678425084306,-.007935130481616249,.99996851635651,-3.685464294963838e-16,.2771796259627252,-.7416031098856175,-.6108979312120354,.4712279125067833,-.1833180383880958,-.862750688945561,.10796498113790386,.30313230983950673,.9468127405032409,-.5137529514094382,.18298058603143774,.8381980732820157,.3992996357642775,-.7406340411636113,.5403896908233663,-.7211644647895409,-.37013657092502356,.5855943421761179,-.6587733062935752,-.7490302523612281,.07050824038866983,.24062651818787278,.7955510642607795,.5560551977082154,.6113022021013235,-.788790685862905,-.06417843564625668,.8720432131220213,-.3574938620779445,.3342735003323128,.9805280292184504,.19483827391213496,.024552615663545295,-.35178332974586846,-.7964331358352397,-.49187676206195835,-.7623577990635767,-.30832516572600294,-.568986975586412,-.8775183418402467,.29531212487630265,-.3778257649168293,-.1422040069486279,-.36554229950395667,-.9198678425084303,.007935130481616249,-.99996851635651,2.648737386723612e-16,-.2771796259627251,.7416031098856171,-.610897931212036,-.4712279125067833,.18331803838809527,-.8627506889455612,-.10796498113790373,-.3031323098395063,.9468127405032412,.5137529514094384,-.18298058603143713,.8381980732820156,-.3992996357642776,.7406340411636116,.540389690823366,.721164464789541,.37013657092502394,.5855943421761175,.6587733062935751,.7490302523612281,.07050824038866935,-.24062651818787256,-.7955510642607793,.556055197708216,-.6113022021013236,.788790685862905,-.06417843564625716,-.8720432131220212,.35749386207794465,.3342735003323128,-.9805280292184504,-.194838273912135,.024552615663545493,.35178332974586857,.7964331358352392,-.4918767620619589];X(n,function(n,o){n.spherePosition=[r[3*o]*t,r[3*o+1]*t,r[3*o+2]*t,1],e&&e(n)})}function M(n,t,e){var r=t/e,o=n.naturalWidth||n.width||n.clientWidth,i=n.naturalHeight||n.height||n.clientHeight,u=o/i,a={position:"absolute"};return u>r?(a.height=O(e),a.left=O((t-e/i*o)/2<<0),a.top=0):(a.width=O(t),a.left=0,a.top=O((e-t/o*i)/2<<0)),a}function S(n,t){return n*n+t*t}function x(n){return S(n.distanceX,n.distanceY)>T*T?!0:void 0}function D(n,t){return i(n,function(n,e,r){t.onSenseStart&&t.onSenseStart(n);var o=n.onUp(function(n){t.onSenseFailure&&t.onSenseFailure(n)}),i=n.onMove(function(n,u,a){n.distanceX=u-e,n.distanceY=a-r;var c=t.isOut(n);void 0!==c&&(i.remove(),o.remove(),c&&t.onSenseSuccess&&t.onSenseSuccess(n,u,a))})})}function b(n){return function(t,r){return D(t,{isOut:n,onSenseSuccess:function(n,t,o){function i(n,t){var e=0===n?void 0:n>0,r=[],o=0,i=+new Date,u=t;return{test:function(n){return void 0===e||!(-20>(n-t)*(e?1:-1))},track:function(n){n=n||t;var u=+new Date,a=u-i,c=n===t?e:n>t;if(c!==e||a>200)r=[],o=0;else if(a>200)r=[],o=0;else{for(o+=a;o>300;)o-=r.shift().duration;r.push({duration:a,distance:n-t})}e=c,t=n,i=u},distance:function(){return t-u+n},direction:function(){return e},speed:function(){var n=0;return X(r,function(t){n+=t.distance}),0===o?0:(n+0)/o}}}function u(){return{distanceX:f.distance(),distanceY:l.distance(),directionX:f.direction(),directionY:l.direction()}}var a=new Date,c=e(),s=e(),f=i(n.distanceX,t),l=i(n.distanceY,o);r(Y(u(),{onDragEnd:s.regist,onDragMove:c.regist})),n.onMove(function(n,t,e){f.test(t)&&l.test(e)&&(f.track(t),l.track(e),c.trig(u()))}),n.onUp(function(){f.track(),l.track(),s.trig(Y(u(),{speedX:f.speed(),speedY:l.speed(),duration:+new Date-a}))})}})}}function E(n,t){var e=Math.sqrt(n*n+t*t);return[n/e,t/e]}function L(e,o){function u(n,t){if(document.documentElement.contains(n))t&&t();else var e=r(n,"DOMNodeInsertedIntoDocument",function(){t&&t(n),e.remove()})}function a(t,e){var r=n("div.item"),o=new Image;return o.onload=function(){u(o,function(){C(o,M(o,v,v))}),r.appendChild(o),e&&e()},o.src=t.avatar,r.comment=t,r}function s(n){x=n,X(h,function(n){C.transform(n,C.translate.apply(null,n.position=A(x,n.spherePosition)))})}function f(){var n=0;T&&T.remove(),T=k(function(){L+=(b-L)/20,s(g(x,D[0]*L,D[1]*L))})}function l(){L=b,T&&T.remove()}var v=25/504*document.querySelectorAll(".main").offsetHeight,d=n("div.sphere-parent",e),p=n("div.sphere",d),m=P,h=[],w=!1,S=0,x=null,D=E(Math.random(),Math.random()),b=.003,L=b,T=null;C.size(p,2*m,2*m),i(e,function(n){n.preventDefault()}),X(o,function(n){var t=a(n);p.appendChild(t),h.push(t)}),y(h,m);var k=function(){var n=null,e=t();return function(t){function r(){null===o&&(o=e.insert(e.node(t),null),null===n&&(n=setTimeout(function r(){var t;if(null!==e.tail())for(n=setTimeout(r,1e3/60),t=e.head();null!==t;t=t.next)t.value();else n=null},1e3/60)))}var o=null;return r(),{start:r,remove:function(){o&&e.remove(o),o=null}}}}();return q(d,function(n){var t=x;d.classList.add("lock"),T.remove(),removeTips(),n.onDragMove(function(n){s(g(t,n.distanceX/200,n.distanceY/200))}),n.onDragEnd(function(n){var t=n.speedX,e=n.speedY,r=Math.sqrt(t*t+e*e);d.classList.remove("lock"),L=r/10,0!==L&&(D=[t/r,e/r]),f()})}),X(h,function(n){H(n,function(){n.position[2]>.2*m&&T.remove()})}),s(c()),Y(e,{fragments:h,runAnimate:f,stopAnimate:l,removeTips:removeTips})}var T=8,k=function(){var n={};return Z.loopArray(["Array","Boolean","Date","Function","Number","Object","RegExp","String","Window","HTMLDocument"],function(t){n[t]=function(n){return Object.prototype.toString.call(n)=="[object "+t+"]"}}),n}();t.loop=function(n,t){for(var e,r=n.head();null!==r;r=r.next)if(void 0!==(e=t(r.value,r)))return e},t.toArray=function(n){var e=[];return t.loop(n,function(n){e.push(n)}),e};var X=Z.loopArray,Y=Z.insert,j=Z.loop,C=Z.css,H=Z.onTap,O=function(n){return 0===n?0:n+"px"},P,z;C.size=function(n,t,e){C(n,{width:t+"px",height:e+"px"})},C.transform=function(){var n=[];X(arguments,function(t,e){0!==e&&n.push(t)}),C(arguments[0],"transform",n.join(" "))},C.translate=function(n,t,e){return u("translate3d",[a(n)+"px",a(t)+"px",a(e)+"px"])},C.scale=function(){return"scale("+Array.prototype.join.call(arguments,",")+")"},P=.1969*document.querySelectorAll(".main").offsetHeight;var q=b(x);window.sp={onPointerDown:i,commentWall:L,element:n}}();