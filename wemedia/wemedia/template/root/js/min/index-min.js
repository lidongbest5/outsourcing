!function(){var a=$(".mobile-nav"),t=$("nav"),e=$(".register-button"),n=$(".email-button"),o=$("a.mail"),i=$(".login-btn"),l=$(".changepwd-btn"),c=$(".reset-button"),r=new RegExp(/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/),s=new RegExp(/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{8,20}$/),d=null,u=0,m=0,p,h=function(){$("#starttime, #endtime").length&&$("#starttime, #endtime").Zebra_DatePicker(),g(),R()},g=function(){$("#img-upload").length&&($("#img-upload").uploadify({swf:"/static/root/js/uploadify.swf",uploader:"/root/upload/",cancelImage:"/static/root/images/cancel.png",buttonClass:"btn",removeCompleted:!0,fileTypeExts:"*.jpg;*.jpeg;*.gif;*.png;*.bmp",multi:!0,auto:!0,buttonText:"上传图片",onUploadSuccess:function(a,t,e){v(t)}}),$("#executetime, #backtime").Zebra_DatePicker())},v=function(a){$(".img-preload").attr("src","/static/upload/"+a),d=a},f=function(){var a=$(this);a.hasClass("toggle")?(a.removeClass("toggle"),t.css("left",-245)):(a.addClass("toggle"),t.css("left",0))},w=function(){var a=$(".mail input"),t=$(".password input"),e=$(".re-password input"),n=$(".name input");if($(".register-container input").removeClass("invalid"),$(".register-container .tip").remove(),r.test(a.val())||(a.addClass("invalid"),$('<p class="tip">'+a.attr("placeholder")+"</p>").insertAfter(a)),t.val().length&&s.test(t.val())||(t.addClass("invalid"),$('<p class="tip">'+t.attr("placeholder")+"</p>").insertAfter(t)),e.val().length&&e.val()===t.val()||(e.addClass("invalid"),$('<p class="tip">'+e.attr("placeholder")+"</p>").insertAfter(e)),n.val().length||(n.addClass("invalid"),$('<p class="tip">'+n.attr("placeholder")+"</p>").insertAfter(n)),$(".register-container input").hasClass("invalid"))return!1;var o=$(this);o.html('<img src="/static/root/images/loading.gif">'),$.ajax({url:"/root/registerValidate/",type:"POST",data:{name:n.val(),mail:a.val(),password:t.val()},success:function(a){a=JSON.parse(a),1==a.code?window.location.href="/root/rootValidation/":(alert("已注册过此邮箱"),o.html("注册"))}})},k=function(){return $(".user, .password, .code-con").removeClass("invalid"),$(".user input").val().length||$(".user").addClass("invalid"),$(".password input").val().length||$(".password").addClass("invalid"),$(".code-con input").val().length||$(".code-con").addClass("invalid"),$(".user, .password, .code-con").hasClass("invalid")?!1:($(".message").hide(),$(this).html('<img src="/static/root/images/loading.gif">'),$.ajax({url:"/root/rootLoginValidate/",type:"POST",data:{mail:$(".user input").val(),pwd:$(".password input").val(),code:$(".code-con input").val()},success:function(a){a=JSON.parse(a),0==a.code?window.location.href="/root/rootValidation/":4==a.code?window.location.href="/root/":2==a.code?($(".message").html("用户名或密码错误").show(),A()):1==a.code&&($(".message").html("验证码错误").show(),A()),i.html("登陆")}}),void 0)},b=function(){var a=$(".mail").html().split("@")[1];window.open("//mail."+a)},x=function(){$(".changepwd-con input").removeClass("invalid"),$(this).html('<img src="/static/root/images/loading.gif">');var a=$(".changepwd-con input"),t=a.eq(0),e=a.eq(1),n=a.eq(2);return t.val().length||t.addClass("invalid"),e.val().length&&s.test(e.val())||e.addClass("invalid"),n.val().length&&e.val()===n.val()||n.addClass("invalid"),$(".changepwd-con input").hasClass("invalid")?!1:void $.ajax({url:"/root/changePwdValidate/",type:"POST",data:{old:t.val(),"new":e.val()},success:function(a){a=JSON.parse(a),0==a.code?(alert("旧密码输入错误"),l.html("确认修改")):1==a.code&&(alert("修改成功"),window.location.href="/root/logout/")}})},y=function(){$(this).hasClass("isToggled")?$(this).removeClass("isToggled"):$(this).addClass("isToggled")},C=function(){if(!($("#name").val().length&&$("#custom").val().length&&$("#account").val().length&&$("#project").val().length&&$("#wechat").val().length))return alert("请输入必填项！"),!1;var a=$("#executetime").val(),t=$("#backtime").val();return a.length&&t.length&&a>t?(alert("执行时间必须在回款时间之前"),!1):($(this).html('<img src="/static/root/images/loading.gif">'),void S("/root/addValidate/","上传",!1))},O=function(){if(!$("#name").val().length&&!$("#custom").val().length)return alert("请输入姓名和客户名称！"),!1;var a=$("#executetime").val(),t=$("#backtime").val();return a.length&&t.length&&a>t?(alert("执行时间必须在回款时间之前"),!1):($(this).html('<img src="/static/root/images/loading.gif">'),void(-1!=window.location.href.indexOf("change")?S("/root/changeValidate/","修改",!0):S("/root/addValidate/","上传",!1)))},S=function(a,t,e){var n=$("#name").val(),o=$("#wechat").val(),i=$("#custom").val(),l=$("#account").val(),c=$("#project").val(),r=1==$("#type1").prop("checked")?1:0,s=1==$("#type2").prop("checked")?1:0,u=1==$("#type3").prop("checked")?1:0,m=1==$("#type4").prop("checked")?1:0,p=1==$("#type5").prop("checked")?1:0,h=1==$("#type6").prop("checked")?1:0,g=1==$("#type7").prop("checked")?1:0,v=$("#bankinfo").val(),f=$("#banknumber").val(),w=$("#count").val(),k=$("#executetime").val().length?$("#executetime").val():"1979-01-01",b=parseInt($('input[name="a"]:checked').val()||0),x=parseInt($('input[name="b"]:checked').val()||0),y=parseInt($('input[name="c"]:checked').val()||0),C=$("#backtime").val().length?$("#backtime").val():"1979-01-01",O=d?d:$(".img-preload").attr("data"),S={name:n,wechat:o,custom:i,type1:r,type2:s,type3:u,type4:m,type5:p,type6:h,type7:g,bankinfo:v,banknumber:f,count:w,executetime:k,executestatus:b,submitstatus:x,comment:y,backtime:C,img:O,account:l,project:c};e&&$.extend(S,{formid:$(".main-container").attr("data")}),$.ajax({url:a,type:"POST",data:S,success:function(a){alert(t+"成功"),window.location.reload()},error:function(){alert(t+"失败，请重试"),window.location.reload()}})},j=function(){u=$(this).attr("data"),$(".modal").fadeIn()},P=function(){m=$(this).attr("data"),$(".modal").fadeIn()},T=function(){$(".modal").fadeOut()},V=function(){u&&($(this).html('<img src="/static/root/images/loading.gif">'),$.ajax({url:"/root/delete/",type:"POST",data:{formid:u},success:function(a){alert("删除成功"),window.location.reload()},error:function(){alert("删除失败，请重试"),window.location.reload()}}))},I=function(){m&&($(this).html('<img src="/static/root/images/loading.gif">'),$.ajax({url:"/root/deleteUser/",type:"POST",data:{formid:m},success:function(a){alert("删除成功"),window.location.reload()},error:function(){alert("删除失败，请重试"),window.location.reload()}}))},A=function(){$(".code-container").remove(),$.ajax({url:"/code/",type:"POST",success:function(a){$(".code").append($('<img src="/code/" class="code-container">'))}})},N=function(a){var t=$(window).width()-a.pageX,e=$(window).height()-a.pageY;$('<img src="'+$(this).attr("src")+'" style="position:fixed;right:'+t+"px;bottom:"+e+'px;max-width:500px;max-height:500px;">').insertAfter($(this))},J=function(a){$(this).next().remove()},Z=function(){var a=$(".reset-input").val(),t=$(this);return t.html('<img src="/static/root/images/loading.gif">'),a.length?void $.ajax({url:"/root/resetPwdValidation/",type:"POST",data:{mail:a},success:function(e){if(e=JSON.parse(e),1==e.code)$(".con1").hide(),$(".mail").html(a),$(".con2").fadeIn();else if(0==e.code)return alert("请输入正确的注册邮箱"),t.html("下一步，安全验证"),!1},error:function(){alert("重置失败，请重试")}}):(alert("请输入正确的注册邮箱"),t.html("下一步，安全验证"),!1)},q=function(){$(this).html('<img src="/static/root/images/loading.gif">'),$.ajax({url:"/root/changeUserValidate/",type:"POST",data:{mediatype:$(".mediatype").val(),mediapeople:$(".mediapeople").val(),mediaattribute:$(".mediaattribute").val(),fans:$(".fans").val(),social:$(".social").val(),account:$("input.account").val(),desc:$(".desc").val(),wechat:$(".wechat").val(),mail:$(".mail").val(),name:$(".name").val(),formid:$(".formid").val()},success:function(a){alert("修改成功"),window.location.reload()},error:function(){alert("修改失败，请重试"),window.location.reload()}})},D=function(){$.ajax({url:"/root/checkName/",type:"POST",data:{wechat:$("#wechat").val()},success:function(a){a=JSON.parse(a),1==a.code&&($("#name").val(a.name),$("#account").val(a.account),$("#bankinfo").val(a.bankinfo),$("#banknumber").val(a.banknumber))},error:function(){}})},E=function(){p=[],$(".select").each(function(){1==$(this).prop("checked")&&p.push($(this).attr("data-id"))}),p.length?($(".handle-modal input").Zebra_DatePicker(),$(".handle-modal").fadeIn()):alert("请选择")},U=function(){var a=$(".handle-modal input").val();a.length?(p=p.toString(),$.ajax({url:"/root/handle/",type:"POST",data:{backtime:a,arr:p},success:function(a){a=JSON.parse(a),1==a.code&&(alert("操作成功"),window.location.reload())},error:function(){}})):alert("请选择日期")},_=function(){$(".handle-modal").fadeOut()},z=function(){$(".select").attr("checked","checked")},R=function(){a.on("touchend",f),e.on("click",w),i.on("click",k),n.on("click",b),o.on("click",b),l.on("click",x),$(".img-preload").on("click",y),$(".add-submit").on("click",C),$(".change-submit").on("click",O),$(".delete").on("click",j),$(".user-delete").on("click",P),$(".change-button").on("click",q),$(".cancel-button").on("click",T),$(".delete-button").on("click",V),$(".delete-user").on("click",I),$(document).on("click",".code-container",A),$(document).on("mouseenter",".img",N),$(document).on("mouseleave",".img",J),c.on("click",Z),$("#wechat").on("keyup",D),$(".handle").on("click",E),$(".handle-modal a.sub").on("click",U),$(".handle-modal a.handle-close").on("click",_),$(".select-all").on("click",z)};$(h)}();