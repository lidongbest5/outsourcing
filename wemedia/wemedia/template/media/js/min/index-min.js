!function(){var a=$(".mobile-nav"),e=$("nav"),t=$(".register-button"),i=$(".email-button"),n=$("a.mail"),l=$(".login-btn"),o=$(".changepwd-btn"),s=$(".change-button"),d=$(".bank-button"),c=$(".reset-button"),r=new RegExp(/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/),u=new RegExp(/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{8,20}$/),p=function(){A()},m=function(){var a=$(this);a.hasClass("toggle")?(a.removeClass("toggle"),e.css("left",-245)):(a.addClass("toggle"),e.css("left",0))},v=function(){var a=$(".mail input"),e=$(".password input"),t=$(".re-password input"),i=$(".account input"),n=$(".name input"),l=$(".wechat input");if($(".register-container input").removeClass("invalid"),$(".register-container .tip").remove(),r.test(a.val())||(a.addClass("invalid"),$('<p class="tip">'+a.attr("placeholder")+"</p>").insertAfter(a)),e.val().length&&u.test(e.val())||(e.addClass("invalid"),$('<p class="tip">'+e.attr("placeholder")+"</p>").insertAfter(e)),t.val().length&&t.val()===e.val()||(t.addClass("invalid"),$('<p class="tip">'+t.attr("placeholder")+"</p>").insertAfter(t)),n.val().length||(n.addClass("invalid"),$('<p class="tip">'+n.attr("placeholder")+"</p>").insertAfter(n)),i.val().length||(i.addClass("invalid"),$('<p class="tip">'+i.attr("placeholder")+"</p>").insertAfter(i)),l.val().length||(l.addClass("invalid"),$('<p class="tip">'+l.attr("placeholder")+"</p>").insertAfter(l)),$(".register-container input").hasClass("invalid"))return $(document).scrollTop(0),!1;var o=$(this);o.html('<img src="/static/root/images/loading.gif">'),$.ajax({url:"/media/registerValidate/",type:"POST",data:{name:n.val(),mail:a.val(),password:e.val(),mediatype:$(".type input").val(),mediapeople:$(".media-people textarea").val(),mediaattribute:$(".media-attribute textarea").val(),fans:$(".fans input").val(),social:$(".social input").val(),account:i.val(),desc:$(".desc textarea").val(),wechat:l.val()},success:function(a){a=JSON.parse(a),1==a.code?window.location.href="/media/mediaValidation/":2==a.code?(alert("已注册过此微信ID"),o.html("注册")):(alert("已注册过此邮箱"),o.html("注册"))}})},h=function(){return $(".user, .password, .code-con").removeClass("invalid"),$(".user input").val().length||$(".user").addClass("invalid"),$(".password input").val().length||$(".password").addClass("invalid"),$(".code-con input").val().length||$(".code-con").addClass("invalid"),$(".user, .password, .code-con").hasClass("invalid")?!1:($(".message").hide(),$(this).html('<img src="/static/root/images/loading.gif">'),$.ajax({url:"/media/mediaLoginValidate/",type:"POST",data:{mail:$(".user input").val(),pwd:$(".password input").val(),code:$(".code-con input").val()},success:function(a){a=JSON.parse(a),0==a.code?window.location.href="/media/mediaValidation/":4==a.code?window.location.href="/media/":5==a.code?window.location.href="/media/guide/":2==a.code?($(".message").html("用户名或密码错误").show(),b()):1==a.code&&($(".message").html("验证码错误").show(),b()),l.html("登陆")}}),void 0)},g=function(){var a=$(".mail").html().split("@")[1];window.open("//mail."+a)},f=function(){$(".changepwd-con input").removeClass("invalid");var a=$(".changepwd-con input"),e=a.eq(0),t=a.eq(1),i=a.eq(2);return e.val().length||e.addClass("invalid"),t.val().length&&u.test(t.val())||t.addClass("invalid"),i.val().length&&t.val()===i.val()||i.addClass("invalid"),$(".changepwd-con input").hasClass("invalid")?!1:($(this).html('<img src="/static/root/images/loading.gif">'),void $.ajax({url:"/media/changePwdValidate/",type:"POST",data:{old:e.val(),"new":t.val()},success:function(a){a=JSON.parse(a),0==a.code?(alert("旧密码输入错误"),o.html("确认修改")):1==a.code&&(alert("修改成功"),window.location.href="/media/logout/")}}))},w=function(){$(this).html('<img src="/static/root/images/loading.gif">'),$.ajax({url:"/media/changeValidate/",type:"POST",data:{mediatype:$(".mediatype").val(),mediapeople:$(".mediapeople").val(),mediaattribute:$(".mediaattribute").val(),fans:$(".fans").val(),social:$(".social").val(),account:$("input.account").val(),desc:$(".desc").val()},success:function(a){alert("修改成功"),window.location.reload()},error:function(){alert("修改失败，请重试"),window.location.reload()}})},k=function(){return $(".bank-other input").val().length&&$(".full-name input").val().length&&$(".bank-number input").val().length?($(this).html('<img src="/static/root/images/loading.gif">'),void $.ajax({url:"/media/bankValidate/",type:"POST",data:{bank:$(".bank-other input").val(),bankname:$(".full-name input").val(),banknumber:$(".bank-number input").val()},success:function(a){alert("修改成功"),window.location.reload()},error:function(){alert("修改失败，请重试"),window.location.reload()}})):(alert("请完整填写银行卡信息！"),!1)},C=function(){var a=$(this).attr("data");$(".bank-other input").val(a)},b=function(){$(".code-container").remove(),$.ajax({url:"/code/",type:"POST",success:function(a){$(".code").append($('<img src="/code/" class="code-container">'))}})},y=function(a){var e=$(window).width()-a.pageX;$('<img src="'+$(this).attr("src")+'" style="position:fixed;right:'+e+"px;top:"+a.pageY+'px;max-width:500px;max-height:500px;">').insertAfter($(this))},x=function(a){$(this).next().remove()},O=function(){var a=$(".reset-input").val(),e=$(this);return e.html('<img src="/static/root/images/loading.gif">'),a.length?void $.ajax({url:"/media/resetPwdValidation/",type:"POST",data:{mail:a},success:function(t){if(t=JSON.parse(t),1==t.code)$(".con1").hide(),$(".mail").html(a),$(".con2").fadeIn();else if(0==t.code)return alert("请输入正确的注册邮箱"),e.html("下一步，安全验证"),!1},error:function(){alert("重置失败，请重试")}}):(alert("请输入正确的注册邮箱"),e.html("下一步，安全验证"),!1)},S=function(a){-1!==$.inArray(a.keyCode,[46,8,9,27,13,110,190])||65==a.keyCode&&a.ctrlKey===!0||a.keyCode>=35&&a.keyCode<=40||(a.shiftKey||a.keyCode<48||a.keyCode>57)&&(a.keyCode<96||a.keyCode>105)&&a.preventDefault()},A=function(){a.on("touchend",m),t.on("click",v),l.on("click",h),i.on("click",g),n.on("click",g),o.on("click",f),s.on("click",w),d.on("click",k),$('.bank-con input[type="radio"]').on("click",C),$(document).on("click",".code-container",b),$(document).on("mouseenter",".img",y),$(document).on("mouseleave",".img",x),c.on("click",O),$(".fans, .social").on("keydown",S)};$(p)}();