!function(){"use strict";var n=$("#prize"),e=n.find(".prize-rotate"),i=n.find(".prize-pointer"),a=n.find(".login-msg"),t=!1,o=0,s=0,d=null,r=!0,l=0,c=0,f=!1,u=!0,p,m=!!window.ActiveXObject&&+/msie\s(\d+)/i.exec(navigator.userAgent)[1]||0/0,h=8>=m,v=function(){w(),b(),C(),q()},g=function(n,e,i,a){$.ajax({type:"POST",url:n,dataType:"json",data:e,success:function(n){0===n.errorCode||a?i(n):alert("网络错误，请重试！")},error:function(){alert("网络错误，请重试！")}})},w=function(){g("https://events.souyidai.com/event/userinfo",{},y)},y=function(e){if(n.find(".tips").hide(),e.user){t=!0,n.find(".prize-btn").removeClass("no-login");for(var i=e.user.awards?e.user.awards.length:0,a="",s=0;i>s;s++){var d=e.user.awards[s].id,r="1个";"1"==d?r="1部":"2"==d&&(r="1台"),a+="<p><span>"+e.user.awards[s].desc+"  "+r+"</span></p>"}e.user.coupon&&(a="<p><span>"+e.user.coupon+'元红包</span><a href="https://www.souyidai.com/myaccount/coupon/list?from=thanksgiving" target="_blank">立即查看</a></p>'+a),0==e.user.coupon&&0==i&&(u=!1),e.user.lotteryCount>0?(o=e.user.lotteryCount,L(),n.find(".tips1").find(".tips-content").html(a),n.find(".tips1").show().find("b").html(e.user.lotteryCount)):(n.find(".tips3").find(".tips-content").html(a),n.find(".tips3").show()),$(".sign-or-reg").css("visibility","hidden")}else n.find(".tips2").show();S()},b=function(){g("https://events.souyidai.com/event/rank",{},k)},k=function(e){for(var i=e.data.length>10?10:e.data.length,a=0;i>a;a++)n.find(".invest-list ul").append('<li class="rank'+a+'"><span>'+e.data[a].username+"</span>"+e.data[a].amount+"</li>")},C=function(){g("https://events.souyidai.com/event/recentlottoryhistory",{},_)},_=function(e){if(d=e,n.find(".prize-list ul").empty(),e.data.length<=8)for(var i=e.data.length,a=0;i>a;a++)n.find(".prize-list ul").prepend("<li><span>"+e.data[a].username+"</span>"+e.data[a].award+"</li>");else{for(var a=0;8>a;a++)n.find(".prize-list ul").prepend("<li><span>"+e.data[a].username+"</span>"+e.data[a].award+"</li>");var i=e.data.length;l=7,window.clearInterval(p),p=setInterval(function(){l++,l>=i&&(l=0);var e=$('<li style="display:none;"><span>'+d.data[l].username+"</span>"+d.data[l].award+"</li>");n.find(".prize-list ul").prepend(e),n.find(".prize-list ul").animate({top:36},500,function(){e.fadeIn(),n.find(".prize-list ul").css("top",0)}),n.find(".prize-list ul li:gt(7)").remove()},3e3)}},z=function(){$(this).hasClass("no-login")?R():f||(0===o?(j(4),u||(n.find(".modal4 .modal-share").remove(),n.find(".modal4 .share-tip").remove(),n.find(".modal4 .modal-tip a").attr("href","https://www.souyidai.com/invest?from=nochance&ifinvest=no"))):(h||e.rotate({angle:0,duration:5e3,animateTo:0}),f=!0,g("https://events.souyidai.com/event/userlottory",{},O,!0)))},O=function(i){if(1===i.errorCode)e.stopRotate(),j(4);else{var a=i.data.id,t=i.data.desc,s;switch(a){case"1":s=0;break;case"2":s=-257;break;case"3":s=-102.8;break;case"10001":s=-308.4;break;case"10002":s=-154.2;break;case"10003":s=-51.4;break;case"10004":s=-205.6}o=i.user.lotteryCount,L(),h&&($(".prize-rotate").remove(),$(".prize-main").prepend('<img class="prize-rotate" src="images/prize-bg.png">'),e=$(".prize-rotate")),e.rotate({angle:0,duration:5e3,animateTo:s+1800,callback:function(){"1"===a||"2"===a||"3"===a?(n.find(".modal1 .modal-title span").html(t),j(1)):o?(n.find(".modal2 .modal-title span").html(t),n.find(".modal2 .modal-sub span").html(o),j(2)):(n.find(".modal3 .modal-title span").html(t),j(3)),w(),C(),f=!1}})}},x=function(){g("https://events.souyidai.com/event/aftershare",{},I)},I=function(n){n.user&&1===n.data&&(o=n.user.lotteryCount,L())},j=function(e){n.find(".modal").hide(),n.find(".modal-container").fadeIn(),n.find(".modal"+e).fadeIn()},T=function(){var e=$(this);n.find(".modal-container").fadeOut()},L=function(){n.find(".tips1 b").html(o)},R=function(){n.find(".modal").hide(),n.find(".modal-container").fadeIn(),n.find(".modal-login").fadeIn()},A=function(){a.hide();var e={username:n.find(".login-name").val(),password:n.find(".login-psd").val()};$("#show-code").hasClass("show")&&(e.kaptcha=$("#code").val()),$("#show-sms-code").hasClass("show")&&(e.smscode=$("#tel-code").val()),g("https://events.souyidai.com/login/jsonLogin",e,function(e){0===e.errorCode?(n.find(".modal-container").fadeOut(),w()):11===e.errorCode?n.find(".show-code").addClass("show"):13===e.errorCode?n.find(".cf").addClass("show"):a.show()},!0)},S=function(){function n(){window.location.href="https://passport.souyidai.com/?backurl="+e}var e=document.URL;$().ready(function(){var n=document.URL;n.indexOf("/myaccount")>=0||n.indexOf("/user")>=0||n.indexOf("/repay")>=0?$("#menu_myaccount").addClass("nav-li-active"):n.indexOf("/agreement/sample/")>=0?$("#menu_invest").addClass("nav-li-active"):n.indexOf("/agreement/")>=0?$("#menu_myaccount").addClass("nav-li-active"):n.indexOf("/borrow")>=0?$("#menu_borrow").addClass("nav-li-active"):n.indexOf("/invest")>=0||n.indexOf("/bid/detail")>=0?$("#menu_invest").addClass("nav-li-active"):(n.indexOf("/portal")>=0||n.indexOf("/",8)<0||n.indexOf("/",8)==n.length-1||1==n.substr(n.indexOf("/",8)).indexOf("#"))&&$("#menu_portal").addClass("nav-li-active")}),$(function(){var n="";null!=$.cookie("syd_name")&&(n=$.base64.atob($.cookie("syd_name"))),n.length>0?($("#login_before").hide(),$("#login_after").show(),$("#login_after").html("您好，<a href='https://www.souyidai.com/myaccount/capital'>"+n+"</a><a href='https://passport.souyidai.com/logout'>【退出】</a>"),$("#login_before_t").hide()):($("#login_before").show(),$("#login_after").hide(),$("#login_before_t").show())})},U=function(){g("https://event.souyidai.com/sendSms",{},function(){n.find(".btn-sms").val("已发送")})},P=function(){$(this).find("img").fadeIn()},X=function(){$(this).find("img").hide()},q=function(){n.find(".prize-btn").on("click",z),n.find(".modal-close").on("click",T),n.find(".modal-continue").on("click",T),n.find(".modal-share a").on("click",x),n.find(".tips-login").on("click",R),$(".header-login, .nav-login").on("click",R),n.find(".login-btn").on("click",A),n.find(".btn-sms").on("click",U),n.find(".wechat").on("mouseenter",P),n.find(".wechat").on("mouseleave",X)};$(v)}();