!function(){"use strict";var n=$("#prize"),i=n.find(".login-msg"),t=!1,e=0,a=0,o=null,d=!0,r=0,l=0,s=!1,f=!0,c,u,m=0,p,g=/Android/i.test(navigator.userAgent),h=function(){b(),z(),x(),w(),y(),O()},v=function(n,i,t,e){$.ajax({type:"POST",url:n,dataType:"json",data:i,success:function(n){0===n.errorCode||e?t(n):alert("网络错误，请重试！")},error:function(){alert("网络错误，请重试！")}})},w=function(){window.win_width=$(".main").width(),n.find(".lottery").css({top:200*window.win_width/320,left:(window.win_width-254)/2})},y=function(){p={appId:"",MsgImg:"",TLImg:"",url:"https://events.souyidai.com/lottery/?from=weixin",title:"投资@搜易贷，赚收益！拿iPhone6！100%中奖，来就送~",desc:"投资@搜易贷，赚收益！拿iPhone6！100%中奖，来就送~",fakeid:"",callback:function(){}};var n=function(){WeixinJSBridge.on("menu:share:appmessage",function(n){WeixinJSBridge.invoke("sendAppMessage",{appid:p.appId,img_url:p.MsgImg,img_width:"120",img_height:"120",link:p.url,desc:p.desc,title:p.title},function(n){p.callback()})}),WeixinJSBridge.on("menu:share:timeline",function(n){p.callback(),WeixinJSBridge.invoke("shareTimeline",{img_url:p.TLImg,img_width:"120",img_height:"120",link:p.url,desc:p.desc,title:p.title},function(n){T()})}),WeixinJSBridge.on("menu:share:weibo",function(n){WeixinJSBridge.invoke("shareWeibo",{content:p.title,url:p.url},function(n){p.callback()})}),WeixinJSBridge.on("menu:share:facebook",function(n){p.callback(),WeixinJSBridge.invoke("shareFB",{img_url:p.TLImg,img_width:"120",img_height:"120",link:p.url,desc:p.desc,title:p.title},function(n){})}),WeixinJSBridge.call("hideToolbar")};document.addEventListener?document.addEventListener("WeixinJSBridgeReady",n,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",n),document.attachEvent("onWeixinJSBridgeReady",n))},b=function(){v("/event/userinfo",{},k)},k=function(i){if("block"===n.find(".login").css("display")&&E(),i.user){t=!0;var a=i.user.awards?i.user.awards.length:0,o="<p>"+i.user.username+'，欢迎您</p><p>剩余刮奖机会：<span class="count">'+i.user.lotteryCount+"</span>次</p>";i.user.coupon&&(o+="<p>刮奖所获奖励："+i.user.coupon+'元红包<a href="https://m.souyidai.com/account/coupon" target="_blank">立即查看</a></p>');for(var d=0;a>d;d++){var r=i.user.awards[d].id,l="1个";"1"==r?l="1部":"2"==r&&(l="1台"),o+="<p>"+i.user.awards[d].desc+"  "+l+"</p>"}0==i.user.coupon&&0==a&&(f=!1),e=i.user.lotteryCount,n.find(".after-login").show().find(".login-tips").html(o),n.find(".before-login").hide()}else n.find(".before-login").show(),n.find(".after-login").hide()},z=function(){v("/event/rank",{},I)},I=function(i){for(var t=i.data.length>5?5:i.data.length,e=0;t>e;e++)n.find(".rank ul").append("<li><i>"+(e+1)+"</i>"+i.data[e].username+"<span>"+i.data[e].amount+"</span></li>")},x=function(){v("/event/recentlottoryhistory",{},S)},S=function(i){if(o=i,n.find(".prize-list ul").empty(),i.data.length<=5)for(var t=i.data.length,e=0;t>e;e++)n.find(".prize-list ul").prepend("<li><span>"+i.data[e].award+"</span>"+i.data[e].username+"</li>");else{for(var e=0;5>e;e++)n.find(".prize-list ul").prepend("<li><span>"+i.data[e].award+"</span>"+i.data[e].username+"</li>");var t=i.data.length;r=4,window.clearInterval(c),c=setInterval(function(){r++,r>=t&&(r=0);var i=$('<li style="display:none;"><span>'+o.data[r].award+"</span>"+o.data[r].username+"</li>");n.find(".prize-list ul").prepend(i),n.find(".prize-list ul").animate({top:36},500,function(){i.fadeIn(),n.find(".prize-list ul").css("top",0)}),n.find(".prize-list ul li:gt(4)").remove()},3e3)}},B=function(){$(this).hasClass("no-login")?R():s||(0===e?(L(4),f||(n.find(".modal5 .share").remove(),n.find(".modal5 img").remove())):($prizeRotate.rotate({angle:0,duration:5e3,animateTo:0}),s=!0,v("/event/userlottory",{},W,!0)))},W=function(i){n.find("#container").empty();var t=new Lottery("container","images/1.png","image",254,135,J);if(t.init("images/2.png","image"),n.find(".lottery-container").show(),n.find(".lottery-prize div").hide(),1===i.errorCode)n.find(".lotter-container").hide(),L(5);else{var a=i.data.id,o=n.find(".lottery-prize div");u=i.data.desc,setTimeout(function(){switch(a){case"1":m=1,o.attr("class","prize2").html("");break;case"2":m=2,o.attr("class","prize3").html("");break;case"3":m=3,o.attr("class","prize4").html("");break;case"10001":m=4,o.attr("class","prize1").html("100"),n.find(".modal-prize").html("100");break;case"10002":m=5,o.attr("class","prize1").html("50"),n.find(".modal-prize").html("50");break;case"10003":m=6,o.attr("class","prize1").html("20"),n.find(".modal-prize").html("20");break;case"10004":m=7,o.attr("class","prize1").html("10"),n.find(".modal-prize").html("10")}e=i.user.lotteryCount,P()},500)}s=!1},_=function(i){if(!s){if(0===e)return L(5),f||(n.find(".modal5 .share").remove(),n.find(".modal5 img").remove()),i.preventDefault(),i.stopPropagation(),!1;m=0,s=!0,v("/event/userlottory",{},W,!0)}},J=function(){1===m||2===m||3===m?e?(n.find(".modal4-prize").html(u),n.find(".modal4-tip").html(e),1===m?n.find(".modal4 .modal-gift img").attr("src","images/iphone.png"):2===m?n.find(".modal4 .modal-gift img").attr("src","images/ipad.png"):n.find(".modal4 .modal-gift img").attr("src","images/aigo.png"),L(4)):(n.find(".modal3-prize").html(u),1===m?n.find(".modal3 .modal-gift img").attr("src","images/iphone.png"):2===m?n.find(".modal3 .modal-gift img").attr("src","images/ipad.png"):n.find(".modal3 .modal-gift img").attr("src","images/aigo.png"),L(3)):e?(n.find(".modal1 .modal1-tip1").html(u),n.find(".modal1 .modal1-tip2").html(e),L(1)):(n.find(".modal2 .modal2-tip1").html(u),L(2)),n.find(".lottery-container").hide(),b(),x(),s=!1},T=function(){v("/event/aftershare",{},C)},C=function(n){n.user&&1===n.data&&(e=n.user.lotteryCount,P())},L=function(i){n.find(".modals").hide(),n.find(".modal").fadeIn(),n.find(".modal"+i).fadeIn(),n.find(".lottery-container").hide()},E=function(){n.find(".modal").hide(),n.find(".modal > div").hide()},P=function(){n.find(".count").html(e)},R=function(){n.find(".modal").hide(),n.find(".modal-container").fadeIn(),n.find(".modal-login").fadeIn()},j=function(){E(),_()},A=function(){i.hide();var t={username:n.find(".login-name").val(),password:n.find(".login-psd").val()};v("/login/jsonLogin",t,function(n){0===n.errorCode?(E(),b()):11===n.errorCode||13===n.errorCode||i.show()},!0)},M=function(){v("https://event.souyidai.com/sendSms",{},function(){n.find(".btn-sms").val("已发送")})},q=function(){$("body,html").animate({scrollTop:0},500)},D=function(){n.find(".wechat-modal").fadeIn()},F=function(i){return n.find(".wechat-modal").hide(),i.preventDefault(),i.stopPropagation(),!1},O=function(){n.find(".close-btn").on("touchstart",E),n.find(".rule-btn").on("touchstart",function(){L(6)}),n.find(".backTop").on("touchstart",q),n.find(".weibo, .qqzone").on("touchstart",T),n.find(".login .login-btn").on("touchstart",A),n.find(".start-btn").on("touchstart",_),n.find(".continue-btn").on("touchstart",j),n.find(".wechat").on("touchstart",D),n.find(".wechat-modal").on("touchstart",F),window.onorientationchange=function(){0!=window.orientation&&alert("请在竖屏状态下浏览")}};$(h)}();