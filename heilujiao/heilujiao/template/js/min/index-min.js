!function(){"use strict";var t=$("body"),a=$(".banner"),e=$(".banner-container >div"),n=$(".banner-dots a"),i=$(".blog-dot a"),s=$(".blog-con"),l=$(".menu-dot a"),r=$(".menu-slide"),c=$(".detail-left"),o=$("nav .login, .login-btn"),d=$("nav .register, .register-btn"),p=$(".close"),u=$(".menu-slide"),f=$(".detail-info .hard"),v=$(".plus"),h=$(".minus"),m=$(".cart-container"),g=$(".address-con .save"),k=$(".address-con .change"),b=$(".submit-container"),w=t.width(),C=new RegExp(/^1\d{10}$/),_=new RegExp(/^\w{6,20}$/),O=0,S=0,y="",J=function(){$.cookie.json=!0,$.cookie("cart")||$.cookie("cart","[]",{path:"/"}),Q(),a.length&&P(),c.length,u.length&&A(),s.length&&I(),f.length&&x(),m.length&&N(),b.length&&T(),ot()},N=function(){for(var t="",a=JSON.parse($.cookie("cart")),e=a.length,n=cart_items.length,i=0,s=0;e>s;s++)for(var l=0;n>l;l++)cart_items[l].id===parseInt(a[s].id)&&(t+='<tr><td><img src="/static/upload/'+cart_items[l].img+'"><span>'+cart_items[l].name+'</span></td><td class="cart_price" data-price="'+cart_items[l].price+'">￥'+cart_items[l].price+'</td><td><a class="minus active">-</a><input type="text" value="'+a[s].count+'" class="cart_count" data-id="'+cart_items[l].id+'"><a class="plus active">+</a></td><td class="cart_total">￥'+cart_items[l].price*a[s].count+'</td><td><a class="delete">删除</a></td></tr>',i+=cart_items[l].price*a[s].count);m.find("tbody").html(t),m.find(".total span").html("￥"+i)},T=function(){var t="",a=JSON.parse($.cookie("cart")),e=a.length,n=cart_items.length,i="运费";O=0;for(var s=0;e>s;s++)for(var l=0;n>l;l++)cart_items[l].id===parseInt(a[s].id)&&(t+="<tr><td>"+cart_items[l].name+"</td><td>￥"+cart_items[l].price+"</td><td>"+a[s].count+"</td><td>￥"+cart_items[l].price*a[s].count+"</td></tr>",O+=cart_items[l].price*a[s].count);order_length>=6&&(O=Math.floor(.95*O),t+="<tr><td></td><td></td><td>会员享受9.5折</td><td>￥"+O+"</td></tr>");var r=0;108>=O&&(0==order_length?(r=0,i="运费(首单免费)"):r=10,O+=r),t+="<tr><td></td><td></td><td>"+i+"</td><td>￥"+r+'</td></tr><tr class="total"><td></td><td></td><td>支付金额</td><td class="total-count">￥'+O+"</td></tr>",b.find("tbody").html(t)},x=function(){var t=f.next("ul"),a=parseInt(f.attr("data-value"));t.find("li:lt("+a+")").addClass("active")},A=function(){for(var t=u.find("li"),a=t.length,e=$(".menu-dot a").length,n=0;e>n;n++){for(var i=12*n,s=n==e-1?a:12*(n+1),l=$("<ul></ul>"),r=i;s>r;r++)l.append(t.eq(r));u.append(l)}},I=function(){for(var t=s.find("li"),a=t.length,e=$(".blog-dot a").length,n=0;e>n;n++){for(var i=2*n,l=n==e-1?a:2*(n+1),r=$("<ul></ul>"),c=i;l>c;c++)r.append(t.eq(c));s.append(r)}},j=function(){var t=$(window).scrollTop();t>180?c.css("top",20):c.css("top",217)},P=function(){a.find("img").width(w),n.on("click",L)},q=function(){c.css("left",(w-1e3)/2-93)},L=function(){var t=$(this),a=parseInt(t.attr("data-id"));TweenLite.to(e,.5,{left:-(a-1)*w}),t.addClass("cur").siblings().removeClass("cur")},M=function(){var t=$(this),a=parseInt(t.attr("data-id"));TweenLite.to(s,.5,{left:780*-(a-1)}),t.addClass("cur").siblings().removeClass("cur")},E=function(){var t=$(this),a=parseInt(t.attr("data-id"));TweenLite.to(r,.5,{left:1e3*-(a-1)}),t.addClass("cur").siblings().removeClass("cur")},R=function(){$(".user-modal").removeClass("register-modal").removeClass("pwd-modal").addClass("login-modal").fadeIn()},D=function(){$(".user-modal").removeClass("login-modal").removeClass("pwd-modal").addClass("register-modal").fadeIn()},z=function(){$(".user-modal").removeClass("login-modal").removeClass("register-modal").addClass("pwd-modal").fadeIn()},B=function(){$(".user-modal").removeClass("login-modal").removeClass("register-modal").fadeOut()},F=function(){var t=$(".user-modal .register"),a=t.find(".phone"),e=t.find(".capcha input"),n=t.find(".password"),i=t.find(".repassword");t.find(".tip").remove(),t.find("input").removeClass("invalid"),$(this).html('<img src="/static/images/loading.gif">'),C.test(a.val())||(a.addClass("invalid"),$('<p class="tip">'+a.attr("placeholder")+"</p>").insertAfter(a)),e.val().length&&e.val()==y||(e.addClass("invalid"),$('<p class="tip">请输入正确验证码</p>').insertAfter(e.closest(".capcha"))),_.test(n.val())||(n.addClass("invalid"),$('<p class="tip">'+n.attr("placeholder")+"</p>").insertAfter(n)),n.val()!=i.val()&&(i.addClass("invalid"),$('<p class="tip">'+i.attr("placeholder")+"</p>").insertAfter(i)),t.find(".invalid").length?$(this).html("注册"):$.ajax({url:"/register/",type:"POST",data:{phone:a.val(),password:n.val()},success:function(t){t=JSON.parse(t),1==t.code?(R(),alert("注册成功！")):($('<p class="tip">此手机号已注册！</p>').insertAfter(i),$(".user-modal .register .submit").html("注册"))}})},G=function(){var t=$(".user-modal .pwdback"),a=t.find(".phone"),e=t.find(".capcha input"),n=t.find(".password"),i=t.find(".repassword");t.find(".tip").remove(),t.find("input").removeClass("invalid"),$(this).html('<img src="/static/images/loading.gif">'),C.test(a.val())||(a.addClass("invalid"),$('<p class="tip">'+a.attr("placeholder")+"</p>").insertAfter(a)),e.val().length&&e.val()==y||(e.addClass("invalid"),$('<p class="tip">请输入正确验证码</p>').insertAfter(e.closest(".capcha"))),_.test(n.val())||(n.addClass("invalid"),$('<p class="tip">'+n.attr("placeholder")+"</p>").insertAfter(n)),n.val()!=i.val()&&(i.addClass("invalid"),$('<p class="tip">'+i.attr("placeholder")+"</p>").insertAfter(i)),t.find(".invalid").length?$(this).html("注册"):$.ajax({url:"/forgetpwd/",type:"POST",data:{phone:a.val(),password:n.val()},success:function(t){t=JSON.parse(t),1==t.code?(R(),alert("找回成功！")):($('<p class="tip">此手机号还没有注册！</p>').insertAfter(i),$(".user-modal .pwdback .submit").html("确定"))}})},H=function(){var t=$(".user-modal .login"),a=t.find(".phone"),e=t.find(".password");t.find(".tip").remove(),$(this).html('<img src="/static/images/loading.gif">'),a.val().length&&e.val().length?$.ajax({url:"/login/",type:"POST",data:{phone:a.val(),password:e.val()},success:function(t){t=JSON.parse(t),0==t.code?(B(),$("nav .user").html('<a href="/address/">您好，'+a.val()+'，</a><a href="/logout/">退出</a>')):($('<p class="tip">手机号或密码错误</p>').insertAfter(e),$(".user-modal .login .submit").html("登录"))}}):($('<p class="tip">请输入账号或密码</p>').insertAfter(e),$(this).html("登录"))},K=function(){for(var t=$(this),a=t.attr("data-id"),e=JSON.parse($.cookie("cart")),n=parseInt($(".count input").val()),i=e.length,s=!1,l=0;i>l;l++)if(e[l].id===a){e[l].count+=n,s=!0;break}s||e.push({id:a,count:n}),$.cookie("cart",JSON.stringify(e),{path:"/"}),$(".cart i").html(e.length),$(".popup").fadeIn(),setTimeout(function(){$(".popup").fadeOut()},1e3)},Q=function(){var t=$.cookie("cart");t=JSON.parse(t),$(".cart i").html(t.length)},U=function(){for(var t=$(this),a=t.attr("data-id"),e=JSON.parse($.cookie("cart")),n=parseInt($(".count input").val()),i=e.length,s=!1,l=0;i>l;l++)if(e[l].id===a){e[l].count+=n,s=!0;break}s||e.push({id:a,count:n}),$.cookie("cart",JSON.stringify(e),{path:"/"}),$(".cart i").html(e.length),window.location.href="/cart/"},V=function(t){var a=$(this),e=a.siblings("input"),n=e.val();e.val(++n),n>1&&$(this).siblings(".minus").addClass("active")},W=function(t){var a=$(this),e=a.siblings("input"),n=e.val(),i=e.attr("data-value");n>i?e.val(--n):$(this).removeClass("active")},X=function(){$(".address").val().length?$(".name").val().length?$(".phone").val().length?$.ajax({url:"/saveAddress/",type:"POST",data:{district:$(".district").val(),address:$(".address").val(),postcode:$(".postcode").val(),name:$(".name").val(),phone:$(".phone").val(),"default":1==$(".default").prop("checked")?1:0},success:function(t){t=JSON.parse(t),1==t.code&&(alert("保存成功"),window.location.reload())}}):alert("手机号码"):alert("收货人姓名"):alert("请输入详细地址")},Y=function(){$(".address").val().length?$(".name").val().length?$(".phone").val().length?$.ajax({url:"/changeAddressSave/",type:"POST",data:{district:$(".district").val(),address:$(".address").val(),postcode:$(".postcode").val(),name:$(".name").val(),phone:$(".phone").val(),"default":1==$(".default").prop("checked")?1:0,id:k.attr("data-id")},success:function(t){t=JSON.parse(t),1==t.code&&(alert("保存成功"),window.location.reload())}}):alert("手机号码"):alert("收货人姓名"):alert("请输入详细地址")},Z=function(){var t=$(this),a=t.siblings("input"),e=a.val();a.val(++e),e>1&&$(this).siblings(".minus").addClass("active");var n=$(this).closest("tr");n.find(".cart_total").html("￥"+n.find(".cart_price").attr("data-price")*n.find(".cart_count").val()),et()},tt=function(){var t=$(this),a=t.siblings("input"),e=a.val();e>1?a.val(--e):$(this).removeClass("active");var n=$(this).closest("tr");n.find(".cart_total").html("￥"+n.find(".cart_price").attr("data-price")*n.find(".cart_count").val()),et()},at=function(){var t=$(this);t.closest("tr").remove(),et()},et=function(){var t=m.find("table tbody tr"),a=t.length,e=[];O=0;for(var n=0;a>n;n++)O+=parseInt(t.eq(n).find(".cart_price").attr("data-price"))*parseInt(t.eq(n).find(".cart_count").val()),e.push({id:t.eq(n).find(".cart_count").attr("data-id"),count:t.eq(n).find(".cart_count").val()});m.find(".total span").html("￥"+O),$.cookie("cart",JSON.stringify(e),{path:"/"})},nt=function(){var t=$(this),a=t.attr("data-id");$.ajax({url:"/deleteAddress/",type:"POST",data:{id:a},success:function(t){t=JSON.parse(t),1==t.code&&(alert("删除成功"),window.location.reload())}})},it=function(){if(!y.length)for(var t=0;4>t;t++)y+=Math.floor(10*Math.random());$.ajax({url:"/setCapcha/",type:"POST",data:{phone:$(".user-modal").hasClass("pwd-modal")?$(".pwdback .phone").val():$(".register .phone").val(),capcha:y},success:function(t){$(".capcha a").addClass("active"),$(".capcha a").off("click",it)}})},st=function(){return $(".user").find(".login").length?(R(),!1):void 0},lt=function(){var t=$(".coupon input").val();t.length?$.ajax({url:"/validateCoupon/",type:"POST",data:{coupon:t},success:function(t){t=JSON.parse(t),1==t.code?(S=t.price,O-=S,$(".total-count").html(O),$(".coupon").html("<span>已使用"+S+'元优惠券</span><a data="'+t.id+'" class="coupon-cancel">取消</a>')):alert("请输入正确优惠券")}}):alert("请输入优惠券")},rt=function(){var t=$(this).attr("data");$.ajax({url:"/cancelCoupon/",type:"POST",data:{coupon:t},success:function(t){t=JSON.parse(t),1==t.code?(O+=S,$(".total-count").html(O),$(".coupon").html('<input type="text" placeholder="输入优惠券号码"><a class="coupon-btn">确认</a>')):alert("失败，请重试")}})},ct=function(){var t=(new Date).getTime();$.ajax({url:"/payment/",type:"POST",data:{transactionid:t,total:O,items:$.cookie("cart")},success:function(a){a=JSON.parse(a),1==a.code&&(window.location.href="/pay/?orderid="+t+"&title=黑鹿角西餐&total="+O)}})},ot=function(){i.on("click",M),l.on("click",E),o.on("click",R),d.on("click",D),$(".forgetpwd").on("click",z),p.on("click",B),$(".user-modal .login .submit").on("click",H),$(".user-modal .register .submit").on("click",F),$(".user-modal .pwdback .submit").on("click",G),$(".addCart").on("click",K),$(".buy").on("click",U),v.on("click",V),h.on("click",W),g.on("click",X),k.on("click",Y),m.on("click",".plus",Z),m.on("click",".minus",tt),m.on("click",".delete",at),$(".delete-address").on("click",nt),$(".capcha a").on("click",it),$(".submit").on("click",st),$(".coupon").on("click",".coupon-btn",lt),$(".coupon").on("click",".coupon-cancel",rt),$(".payment").on("click",ct)};$(J)}();